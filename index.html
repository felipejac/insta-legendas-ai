<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Gerador de Legendas Magn√©ticas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #f7f4ff;
      --card: #ffffff;
      --primary: #7c5cff;
      --primary-dark: #5b3fe0;
      --text: #1f1b2e;
      --muted: #6b657f;
      --border: #e0d9ff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
    }
    .app {
      width: 100%;
      max-width: 960px;
      padding: 24px;
    }
    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 22px 45px rgba(15, 11, 38, 0.12);
      border: 1px solid var(--border);
    }
    h1 {
      font-size: 1.7rem;
      margin: 0 0 8px;
    }
    p.subtitle {
      margin: 0 0 24px;
      color: var(--muted);
    }
    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 6px;
      font-weight: 500;
    }
    textarea, input {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      font-size: 0.95rem;
      resize: vertical;
      min-height: 60px;
    }
    input { min-height: 40px; }
    textarea:focus, input:focus {
      outline: 2px solid var(--primary);
      border-color: transparent;
    }
    .field {
      margin-bottom: 16px;
    }
    .actions {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 8px 0 20px;
      flex-wrap: wrap;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 10px 18px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--primary);
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background 0.15s ease, transform 0.05s ease;
    }
    button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
      transform: none;
    }
    .status {
      font-size: 0.85rem;
      color: var(--muted);
    }
    .results {
      border-top: 1px dashed var(--border);
      padding-top: 16px;
    }
    .results-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .legend-list {
      display: grid;
      gap: 12px;
    }
    .legend-item {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      background: #faf8ff;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }
    .legend-text {
      font-size: 0.9rem;
      white-space: pre-wrap;
    }
    .legend-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .btn-secondary {
      background: transparent;
      color: var(--primary);
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 0.8rem;
      border-radius: 999px;
    }
    .btn-secondary:hover {
      background: #eee6ff;
      transform: none;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 10px;
      background: #efe9ff;
      color: var(--primary-dark);
      font-size: 0.8rem;
      font-weight: 500;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="card">
      <div class="badge">
        ‚ö° App de IA para Instagram
      </div>
      <h1>Gerador de Legendas Magn√©ticas</h1>
      <p class="subtitle">
        Descreva o seu produto e receba legendas prontas para vender mais no Instagram, com CTA agressivo e linguagem simples.
      </p>

      <div class="field">
        <label for="input-produto">Descreva o seu produto/neg√≥cio</label>
        <textarea id="input-produto" placeholder="Ex: Hamburgueria artesanal em S√£o Paulo, foco em delivery noturno, p√∫blico jovem que gosta de promo√ß√µes e combos."></textarea>
      </div>

      <div class="field">
        <label for="input-publico">P√∫blico-alvo (opcional)</label>
        <input id="input-publico" type="text" placeholder="Ex: Jovens de 18 a 30 anos, moradores da zona sul de SP.">
      </div>

      <div class="field">
        <label for="input-tom">Tom da legenda (opcional)</label>
        <input id="input-tom" type="text" placeholder="Ex: Engra√ßado e direto, com senso de urg√™ncia.">
      </div>

      <div class="actions">
        <button id="btn-gerar">
          <span>Gerar legendas agora</span>
        </button>
        <span class="status" id="status-texto">Pronto para gerar legendas.</span>
      </div>

      <div class="results" id="resultados">
        <div class="results-title">Suas legendas aparecer√£o aqui üëá</div>
        <div class="legend-list" id="lista-legendas"></div>
      </div>
    </section>
  </main>

  <script>
    // ========= CONFIGURA√á√ÉO B√ÅSICA =========
    const GEMINI_API_KEY = "AIzaSyDqFMcWaPTxajuFAtPNWpJP7mXUuYbPIbU"; // configure pelo .env / backend idealmente
    const GEMINI_MODEL = "gemini-3.0-flash";       // ajuste para o nome exato do modelo dispon√≠vel

    const elProduto = document.getElementById("input-produto");
    const elPublico = document.getElementById("input-publico");
    const elTom = document.getElementById("input-tom");
    const elBotao = document.getElementById("btn-gerar");
    const elStatus = document.getElementById("status-texto");
    const elLista = document.getElementById("lista-legendas");

    async function gerarLegendas() {
      const produto = elProduto.value.trim();
      const publico = elPublico.value.trim();
      const tom = elTom.value.trim();

      if (!produto) {
        alert("Descreva o seu produto/neg√≥cio antes de gerar as legendas.");
        elProduto.focus();
        return;
      }

      elBotao.disabled = true;
      elStatus.textContent = "Gerando legendas com IA...";
      elLista.innerHTML = "";

      try {
        // Monta o prompt em portugu√™s, com instru√ß√µes claras
        const userPrompt = `
Voc√™ √© um copywriter especialista em Instagram para pequenos neg√≥cios no Brasil.
Gere 3 legendas curtas e agressivas de venda, com CTA claro e linguagem simples, usando os dados abaixo.

Produto/neg√≥cio:
${produto}

P√∫blico-alvo (se informado):
${publico || "n√£o informado"}

Tom desejado (se informado):
${tom || "n√£o informado"}

Regras:
- Escreva em portugu√™s do Brasil.
- Cada legenda deve caber em um post de Instagram (m√°x. 3 linhas cada).
- Use gatilhos de urg√™ncia/promessa quando fizer sentido.
- No final de cada legenda, inclua um CTA claro (ex: Pe√ßa agora, Clique no link da bio).
- Retorne APENAS um JSON com o formato:
{ "legendas": ["...", "...", "..."] }
        `.trim();

        // Corpo da requisi√ß√£o seguindo o padr√£o da Gemini API (generateContent)
        const body = {
          contents: [
            {
              role: "user",
              parts: [{ text: userPrompt }]
            }
          ]
        };

        const response = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/" +
            GEMINI_MODEL +
            ":generateContent?key=" +
            encodeURIComponent(GEMINI_API_KEY),
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(body)
          }
        );

        if (!response.ok) {
          throw new Error("Erro na chamada √† API: " + response.status);
        }

        const data = await response.json();

        // A resposta t√≠pica vem em candidates[0].content.parts[0].text
        const text =
          data?.candidates?.[0]?.content?.parts?.[0]?.text || "";

        let json;
        try {
          json = JSON.parse(text);
        } catch (e) {
          console.error("Falha ao fazer parse do JSON retornado:", text);
          throw new Error("A IA n√£o retornou o JSON no formato esperado.");
        }

        const legendas = json.legendas || [];

        if (!Array.isArray(legendas) || legendas.length === 0) {
          throw new Error("Nenhuma legenda v√°lida retornada pela IA.");
        }

        // Renderiza as legendas na UI
        elLista.innerHTML = "";
        legendas.forEach((legenda, index) => {
          const item = document.createElement("div");
          item.className = "legend-item";

          const textEl = document.createElement("div");
          textEl.className = "legend-text";
          textEl.textContent = legenda;

          const actionsEl = document.createElement("div");
          actionsEl.className = "legend-actions";

          const btnCopiar = document.createElement("button");
          btnCopiar.className = "btn-secondary";
          btnCopiar.type = "button";
          btnCopiar.textContent = "Copiar";
          btnCopiar.addEventListener("click", () => {
            navigator.clipboard.writeText(legenda).then(() => {
              btnCopiar.textContent = "Copiado!";
              setTimeout(() => {
                btnCopiar.textContent = "Copiar";
              }, 1500);
            });
          });

          actionsEl.appendChild(btnCopiar);
          item.appendChild(textEl);
          item.appendChild(actionsEl);
          elLista.appendChild(item);
        });

        elStatus.textContent = "Legendas geradas com sucesso. Ajuste o prompt se quiser afinar o tom.";
      } catch (err) {
        console.error(err);
        elStatus.textContent = "Falha ao gerar legendas. Tente novamente em alguns instantes.";
        alert("Erro ao gerar legendas: " + err.message);
      } finally {
        elBotao.disabled = false;
      }
    }

    elBotao.addEventListener("click", gerarLegendas);
  </script>
</body>
</html>
